/*â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 ğŸŒ€  MACRO: RECALL SOBRE RUNA SUELTA
 ğŸ“…  VersiÃ³n : 1.3 Â· 23-May-2025
 âœï¸  Autor   : Voorhees
 ğŸ—ºï¸  Servidor: Ãšltima Alianza
 ğŸ’»  Cliente : ClassicUO Web

 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ğŸ“–  INSTRUCCIONES  ğŸ“– â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 â€¢ La macro detecta cualquier runa suelta en tu backpack, sin importar su
   orientaciÃ³n (graphics 0x1F14, 0x1F15, 0x1F16, 0x1F17), lanza Recall y
   muestra una cuenta atrÃ¡s de 7 â†’ 0 s sÃ³lo visible para ti.
 â€¢ Todos los parÃ¡metros se encuentran en CONFIG.
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/

/*â•â•â•â•â•â•â•â•â•â•â•â• âš™ï¸  CONFIGURACIÃ“N  âš™ï¸ â•â•â•â•â•â•â•â•â•â•â•â•
   runeGraphics : Lista de grÃ¡ficos vÃ¡lidos de runas marcadas
   spell        : Hechizo que se lanzarÃ¡
   targetDelay  : Tiempo mÃ¡x. (ms) para que aparezca el cursor
   recallCast   : Segundos estimados entre el cast y el teleport
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
const CFG = {
  runeGraphics : [0x1F14, 0x1F15, 0x1F16, 0x1F17], // ğŸ“¦ Runas NSEW
  spell        : Spells.Recall,                    // âœ¨ Hechizo principal
  targetDelay  : 8000,                             // â³ Cursor mÃ¡x. 8 s
  recallCast   : 7                                 // ğŸ”¢ Cuenta atrÃ¡s
};

/*â•â•â•â•â•â•â•â•â•â•â•â• ğŸ› ï¸  UTILIDADES  ğŸ› ï¸ â•â•â•â•â•â•â•â•â•â•â•â•â•*/
const log  = (m:string,h=66)=>client.sysMsg(m,h);

/** Devuelve la primera runa encontrada de cualquier orientaciÃ³n. */
function findRune(): Item | undefined {
  for (const g of CFG.runeGraphics) {
    const r = client.findType(g, undefined, player.backpack) as Item;
    if (r) return r;
  }
}

/** Cuenta atrÃ¡s sincronizada con el Journal (termina antes si teleporta). */
function countdown(sec:number){
  for(let s=sec;s>=0;s--){
    log(`â³ Teleporte en ${s}s`,66);
    if(journal.waitForText('You have been teleported','System',1000)) return;
  }
}

/*â•â•â•â•â•â•â•â•â•â•â•â• ğŸš€  EJECUCIÃ“N  ğŸš€ â•â•â•â•â•â•â•â•â•â•â•â•â•â•*/
(()=>{
  const rune = findRune();
  if(!rune){log('âŒ No hay runas en la mochila.',33);return;}

  log('âŒ› Lanzando Recallâ€¦',66);
  client.castSpell(CFG.spell);
  if(!target.wait(CFG.targetDelay)){
    log('âš ï¸  No se abriÃ³ el cursor.',33);return;
  }
  target.entity(rune);

  countdown(CFG.recallCast);
  log('âœ… Â¡EstÃ¡s a salvo!.',65);
})();
