/*â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 ğŸŒ€  MACRO: POCIÃ“N DE INVISIBILIDAD + RECALL SOBRE RUNA
 ğŸ“…  VersiÃ³n : 1.4 Â· 23-May-2025
 âœï¸  Autor   : Voorhees
 ğŸ—ºï¸  Servidor: Ãšltima Alianza
 ğŸ’»  Cliente : ClassicUO Web

 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ğŸ“–  INSTRUCCIONES  ğŸ“– â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     1) Bebe la pociÃ³n (.invisibilidad).
     2) Busca la primera runa suelta en la mochila (graphics 0x1F14-17).
     3) Lanza Recall, apunta la runa y muestra cuenta atrÃ¡s 7 â†’ 0 s.
 â€¢ Todos los parÃ¡metros editables estÃ¡n en CONFIG.
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/

/*â•â•â•â•â•â•â•â•â•â•â•â• âš™ï¸  CONFIGURACIÃ“N  âš™ï¸ â•â•â•â•â•â•â•â•â•â•â•â•*/
const CFG = {
  runeGraphics : [0x1F14, 0x1F15, 0x1F16, 0x1F17], // ğŸ“¦ Runas NSEW
  spell        : Spells.Recall,                    // âœ¨ Hechizo principal
  invisCmd     : '.invisibilidad',                 // ğŸ§ª Comando pociÃ³n
  invisDelay   : 0,                                // ğŸ’¤ Pausa tras la pociÃ³n (ms)
  targetDelay  : 600,                              // â³ Tiempo mÃ¡x. cursor
  recallCast   : 7                                 // ğŸ”¢ Segundos de cuenta atrÃ¡s
};

/*â•â•â•â•â•â•â•â•â•â•â•â• ğŸ› ï¸  UTILIDADES  ğŸ› ï¸ â•â•â•â•â•â•â•â•â•â•â•â•â•*/
const log = (m: string, h = 66) => client.sysMsg(m, h);

/** Encuentra la primera runa vÃ¡lida, sin importar orientaciÃ³n. */
function findRune(): Item | undefined {
  for (const g of CFG.runeGraphics) {
    const r = client.findType(g, undefined, player.backpack) as Item;
    if (r) return r;
  }
}

/** Cuenta atrÃ¡s; se corta si detecta el teleport en el Journal. */
function countdown(sec: number) {
  for (let s = sec; s >= 0; s--) {
    log(`â³ Teleporte en ${s}s`, 66);
    if (journal.waitForText('You have been teleported', 'System', 1000)) return;
  }
}

/*â•â•â•â•â•â•â•â•â•â•â•â• ğŸš€  EJECUCIÃ“N  ğŸš€ â•â•â•â•â•â•â•â•â•â•â•â•â•â•*/
(() => {
  /* Paso 1 Â· Invisibilidad */
  log('ğŸ§ª Bebiendo pociÃ³n de invisibilidadâ€¦', 66);
  player.say(CFG.invisCmd);
  sleep(CFG.invisDelay);                    // breve pausa fija

  /* Paso 2 Â· Buscar runa */
  const rune = findRune();
  if (!rune) { log('âŒ No hay runas en la mochila.', 33); return; }

  /* Paso 3 Â· Recall */
  log('âŒ› Lanzando Recallâ€¦', 66);
  client.castSpell(CFG.spell);
  if (!target.wait(CFG.targetDelay)) {
    log('âš ï¸  No se abriÃ³ el cursor.', 33);
    return;
  }
  target.entity(rune);

  /* Paso 4 Â· Cuenta atrÃ¡s */
  countdown(CFG.recallCast);
  log('âœ… Â¡EstÃ¡s a salvo!.', 65);
})();
